---
title: "Projet DM"
author: "Rochd"
date: "25 octobre 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Exploration des données

## Chargement des données
Nous allons charger et fusionner les bases de données en gardant uniquement les attributs nécessaires.

Base d'apprentissage :
```{r}
df<-read.csv("train.csv")
df$Date<- as.POSIXct(df$Date ,format = "%Y-%m-%d")
```


Base de tests :
```{r}
test<-read.csv("test.csv")
```



Pour la base contenant les magasins nous allons adapter les attributs "CompetitionOpenSinceMonth" et "CompetitionOpenSinceYear"ansi que "Promo2SinceWeek" et "Promo2SinceYear" pour représenter une date précise sous le format "AAAA-MM-JJ" du calendrier POSIXct. 

```{r}
store<-read.csv("store.csv",na.strings = "")
store$Promo2Since <- as.POSIXct(paste(store$Promo2SinceYear,store$Promo2SinceWeek, 1, sep = "-"),format = "%Y-%U-%u")
store$CompetitionOpenSince<- as.POSIXct(paste(store$CompetitionOpenSinceYear ,store$CompetitionOpenSinceMonth , 1, sep = "-"),format = "%Y-%m-%d")

#Delete redundant features
store$CompetitionOpenSinceMonth<-NULL
store$CompetitionOpenSinceYear<-NULL
store$Promo2SinceWeek<-NULL
store$Promo2SinceYear<-NULL
```

Visualisation des données manquantes :
```{r}
library(Amelia)
missmap(store, main = "Données manquantes/Données observées")
sapply(store,function(x) sum(is.na(x)))

```

Pour les valeurs manquantes en relation avec le fait que le magasin participe à la promotion ou non ne causent aucun problème.
Concernant les 3 valeurs manquantes de l'attribut "CompetitionDistance" on observe :
```{r}
hist(store$CompetitionDistance)
```
La majorité des magasins ont une distance de compétition inférieur à 5000
On choisira donc des valeurs inférieur à 5000 pour ces données manquantes.

```{r}
store$CompetitionDistance[is.na(store$CompetitionDistance)]<-as.integer(runif(3, 0, 5000))
```

Données manquantes de la base des tests :
```{r}
sapply(test,function(x) sum(is.na(x)))
```
Nous allons selectionner les lignes qui correspendent à ces valeurs manquantes :

```{r}
test[is.na(test$Open), ]
```
Ceci correspond uniquement au magasin numéro 622 : 
```{r}
table(test$Open[test$Store == 622])
```

Dans la majorité des cas le magasin est ouvert :
Nous allons donc affecter des "1" aux valeurs manquantes :

```{r}
test[is.na(test)] <- 1
```


## Distribution des ventes
 
La distribution des ventes lorsque le magasin est ouvert 
```{r}
library(ggplot2)
ggplot(df[df$Sales!=0,], aes(Sales))+geom_histogram(bins = 100)
```


#



```{r}
train <-merge(df,store)

#which(mergedData$Date<mergedData$Promo2Since)
Inferieur=train[which(train$Date<train$Promo2Since & train$Store==213),]
mean(Inferieur$Sales)
superieur=train[which(train$Date>=train$Promo2Since & train$Store==213),]
mean(superieur$Sales)
```

